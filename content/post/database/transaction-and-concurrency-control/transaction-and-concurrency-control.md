---
title: "事务与并发控制"
description: 
date: 2023-10-07T23:43:19+08:00
image:
url: /db/transaction-and-concurrency-control
math: false
comments: true
draft: false
categories:
---

# 事务

**事务的ACID属性**

- **A 原子性**，事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生
- **C 一致性**，事务必须使数据库从一个一致性状态变换到另一个一致性状态
- **I 隔离性**，一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰
- **D 持久性**，事务一旦提交，它对数据库中的数据的改变就是永久性的，接下来的其他操作和数据库故障不应该对其有任何影响

原子性,持久性,隔离性由DBMS保证,一致性由事务编写者保证

**SQL事务语句**
- 事务启动: `BEGIN`
- 事务提交 `COMMIT`
- 事务回滚 `ROLLBACK`

# 并发控制

为了简化问题考虑，在并发时，先不考虑数据的增删,只考虑数据的读写

## 调度

调度是一个或多个事务的重要操作的序列

串行调度:不同事务的操作没有交叉

费串行调度:不同事务的操作有交叉

**异常**

非串行调度可能会导致事务的异常行为,从而破坏数据库的一致性

- 脏写(dirty write)
- 脏读(dirty read)
- 不可重复读(unrepeatable read)
- 幻读(phantom read)

脏写:在事务T2提交前,T2写的A值被事务T1修改

下图的示例即为事务2在修改了A的值之后(25->50),T1的写操作覆盖了T2的写操作(->125)
![脏写示意](image.png)

脏读:在事务T1提交前,T1写的值被事务T2读取到

![脏读示意](image-1.png)
