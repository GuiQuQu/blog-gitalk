---
title: "第二章 关系代数与SQL语句"
description: 
date: 2023-10-07T23:38:37+08:00
image:
url: /db/sql
math: true
comments: true
draft: false
categories:
---

# 关系数据模型

三要素
- 关系数据结构
- 关系操作
- 关系完整性约束

**关系数据结构**

不严格地讲,关系就是一张二维表(table)
- 行(row) —— 元组(tuple)/记录(record),一行表示一个对象
- 列(column) —— 属性(attribute)/域(field),一列表示一个属性

关系的键

关系种某些属性集合具有区分不同元组的作用,称为键(key)

- 超键

如果关系种某一组属性的值能唯一标识每个元组,则称改组属性为超键(super key)

例如,在关系SC(Sno,Cno,Grade)中,属性组{Sno,Cno},和{Sno,Cno,Grade}都是超键
![](2023-10-08-00-11-46.png)

- 候选键
如果一个超键的任意真子集都不是超键,则称该超键为候选键
候选键 = 极小的超键

例如上面那个表中,Sno和Cno都不是关系SC的超键,候选键为{Sno,Cno}

- 主键

每个关系都有至少一个候选键,人为指定其中一个作为主键(primary key)

- 外键
不同的关系中的元组可以存在联系,这种联系是通过外键建立起来的

设$F$是关系$R$的属性子集,若$F$与关系$S$的主键相对应,则称F是R的外键(foreign key)
- R 参照关系(外键位于R中)
- S 被参照关系
- R与S可以是同一关系

例子
![](2023-10-08-00-17-50.png)

{Sdept}是Student的外键,这个外键参照了{Department}的主键{Dept}

**关系操作**

增删改查

**关系完整性约束**
实体完整性约束
- 主键唯一
- 主键不能为空

参照完整性约束

设F是关系R的外键,F参照关系S的主键,则F中的任意元组的F属性值必须满足以下两个条件之一
- F的值为空
- 若F的值不为空,则F的值必须在S的主键中存在
  
总结:*外键的值要么为空,要么一定出现在参照的主键中*

**用户定义完整性约束**
用户定义的对数据的约束条件,例如
- 考试成绩在0-100之间
- 性别必须为'M' or 'F'
  
# 关系代数

关系代数基本操作
1. 选择 $\sigma$
2. 投影 $\pi$
3. 并 $\cup$
4. 差 $-$
5. 笛卡尔积 $\times$
6. 重命名 $\rho$

## 选择操作
- 功能:从一个关系中选出满足给定条件的元组
- 语法:$\sigma_{条件}(关系)$

例子
- 找出计算机系的全体学生
  $\sigma_{Sdept='CS'}(Student)$
- 找出计算机系的全体男学生
  $\sigma_{Sdept='CS' \wedge Ssex='M'}(Student)$

## 投影操作
- 功能:从一个关系中选出满足给定条件的属性
- 语法:$\pi_{属性}(关系)$

例子:
- 找出全体学生的学号和姓名
$\pi_{Sno,Sname}(Student)$
- 找出全部的系 
  $\pi_{Sdept}(Student)$

## 并操作
- 功能: 计算关系R和S的并集
- 语法: $R \cup S$

要求:
1. R和S必须具有相同个数的属性
2. R和S的对应属性的值必须相容

例子:
- 找出计算机系和电子系的全体学生

$\sigma_{Sdept='CS'}(Student) \cup \sigma_{Sdept='MA'}(Student)$

![](2023-10-08-00-29-56.png)

## 差操作
- 功能: 计算关系R和S的差集
- 语法: $R - S$

要求:
1. R和S必须具有相同个数的属性
2. R和S的对应属性的值必须相容

例子: 查询选修了1002号课程,但是没有选修3006号课程的学生的学号
# sql语句